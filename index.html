<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafafa;
            color: #1a1a1a;
            margin: 0;
            overflow: hidden; /* Prevent bounce scroll on mobile */
            -webkit-font-smoothing: antialiased;
        }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(3px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .item-shadow { box-shadow: 0 2px 8px -2px rgba(0,0,0,0.06); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body class="h-screen w-screen flex flex-col items-center overflow-hidden">
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Data Definitions ---
        const NEWS_LINKS = [
            { id: 'n1', name: 'The Guardian', url: 'https://www.theguardian.com/uk', domain: 'theguardian.com' },
            { id: 'n2', name: 'AT5', url: 'https://www.at5.nl', domain: 'at5.nl' },
            { id: 'n3', name: 'NOS', url: 'https://nos.nl', domain: 'nos.nl' },
            { id: 'n4', name: 'Resident Advisor', url: 'https://ra.co', domain: 'ra.co' },
        ];

        const TOOL_LINKS = [
            { id: 't1', name: 'Claude AI', url: 'https://claude.ai', domain: 'claude.ai' },
            { id: 't2', name: 'Akhi Gym', url: 'https://www.akhigym.nl/blank-2', domain: 'akhigym.nl' },
        ];

        // Custom order: NTS 1, NTS 2, FunX, then Rinse and Reprezent (direct links)
        const DEFAULT_RADIO = [
            { id: 'r1', name: 'NTS 1', url: 'https://www.nts.live', streamUrl: 'https://stream-relay-geo.ntslive.net/stream?type=.mp3', domain: 'nts.live' },
            { id: 'r1-2', name: 'NTS 2', url: 'https://www.nts.live', streamUrl: 'https://stream-relay-geo.ntslive.net/stream2?type=.mp3', domain: 'nts.live' },
            { id: 'r2', name: 'FunX', url: 'https://www.funx.nl', tracklistUrl: 'https://www.funx.nl/radio/playlist', streamUrl: 'https://icecast.omroep.nl/funx-bb-mp3', domain: 'funx.nl' },
            { id: 'r4', name: 'Rinse FM', url: 'https://rinse.fm', domain: 'rinse.fm' }, // streamUrl removed
            { id: 'r3', name: 'Reprezent', url: 'https://www.reprezent.org.uk', domain: 'reprezent.org.uk' }, // streamUrl removed
        ];

        // --- UI Components ---

        const GridItem = ({ item, isRadio, onRemove, onEdit, isPlaying, onTogglePlay }) => {
            const favicon = `https://www.google.com/s2/favicons?domain=${item.domain}&sz=128`;
            
            return (
                <div className="group relative flex flex-col items-center w-full max-w-[90px] md:max-w-[100px]">
                    <div className="relative flex flex-col items-center gap-1.5 w-full">
                        <div 
                            onClick={() => {
                                if (item.streamUrl) {
                                    onTogglePlay?.(item);
                                } else {
                                    window.open(item.url, '_blank');
                                }
                            }}
                            className={`relative w-16 h-16 md:w-20 md:h-20 bg-white rounded-2xl item-shadow border border-gray-200 flex items-center justify-center overflow-hidden transition-all duration-200 cursor-pointer ${isPlaying ? 'ring-2 ring-black scale-105' : 'hover:scale-105 hover:border-gray-400'}`}
                        >
                            <img src={favicon} alt={item.name} className={`w-8 h-8 md:w-10 md:h-10 transition-opacity ${isPlaying ? 'opacity-20' : 'opacity-100'}`} />
                            {item.streamUrl && (
                                <div className={`absolute inset-0 flex items-center justify-center transition-opacity ${isPlaying ? 'opacity-100' : 'opacity-0 group-hover:opacity-100 bg-black/5'}`}>
                                    {isPlaying ? (
                                        <div className="flex gap-1">
                                            <span className="w-1 h-3.5 bg-black animate-bounce"></span>
                                            <span className="w-1 h-3.5 bg-black animate-bounce" style={{animationDelay:'0.1s'}}></span>
                                        </div>
                                    ) : (
                                        <div className="w-0 h-0 border-t-[7px] border-t-transparent border-l-[11px] border-l-black border-b-[7px] border-b-transparent ml-1"></div>
                                    )}
                                </div>
                            )}
                        </div>
                        <a href={item.url} target="_blank" className="text-[10px] md:text-[11px] font-extrabold text-gray-700 uppercase tracking-widest text-center truncate w-full px-1">{item.name}</a>
                    </div>
                    {item.tracklistUrl && (
                        <a href={item.tracklistUrl} target="_blank" className="text-[8px] md:text-[9px] uppercase text-gray-400 font-bold hover:text-black mt-0.5 tracking-tighter transition-colors">Tracklist</a>
                    )}
                    {isRadio && (
                        <div className="absolute -top-1 -right-1 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 scale-75">
                            <button onClick={(e) => { e.stopPropagation(); onRemove(item.id); }} className="bg-white border border-gray-200 p-1.5 rounded-full text-gray-400 hover:text-red-500 shadow-sm">
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" strokeWidth="3" strokeLinecap="round"/></svg>
                            </button>
                            <button onClick={(e) => { e.stopPropagation(); onEdit(item); }} className="bg-white border border-gray-200 p-1.5 rounded-full text-gray-400 hover:text-black shadow-sm">
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" strokeWidth="3" strokeLinecap="round"/></svg>
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const StationModal = ({ isOpen, onClose, onConfirm, item }) => {
            const [data, setData] = useState({ name: '', url: '', streamUrl: '', tracklistUrl: '' });
            useEffect(() => {
                if (item) setData(item);
                else setData({ name: '', url: '', streamUrl: '', tracklistUrl: '' });
            }, [item, isOpen]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-white/95 backdrop-blur-lg z-50 flex items-center justify-center p-6">
                    <div className="bg-white border border-gray-200 shadow-2xl rounded-3xl w-full max-w-xs p-8 animate-fade">
                        <h2 className="text-[10px] font-black uppercase tracking-[0.4em] mb-6 text-gray-800">Station</h2>
                        <div className="space-y-4">
                            {['name', 'url', 'streamUrl', 'tracklistUrl'].map(key => (
                                <div key={key}>
                                    <label className="block text-[8px] uppercase tracking-widest text-gray-500 font-bold mb-1">{key.replace(/([A-Z])/g, ' $1').toUpperCase()}</label>
                                    <input 
                                        className="w-full border-b-2 border-gray-100 py-1 focus:border-black outline-none text-[11px] font-semibold text-gray-800" 
                                        value={data[key] || ''} 
                                        onChange={e => setData({...data, [key]: e.target.value})}
                                    />
                                </div>
                            ))}
                        </div>
                        <div className="flex gap-2 mt-8">
                            <button onClick={() => {
                                const domain = (data.url.replace(/(^\w+:|^)\/\//, '').split('/')[0]) || 'link';
                                onConfirm({ ...data, id: data.id || Date.now().toString(), domain });
                                onClose();
                            }} className="flex-1 bg-black text-white text-[9px] uppercase tracking-widest py-3 rounded-xl font-bold shadow-lg">Confirm</button>
                            <button onClick={onClose} className="px-3 text-[9px] uppercase tracking-widest font-bold text-gray-400">Back</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [radio, setRadio] = useState([]);
            const [modal, setModal] = useState({ open: false, item: null });
            const [playing, setPlaying] = useState(null);
            const audio = useRef(null);

            useEffect(() => {
                audio.current = new Audio();
                const saved = localStorage.getItem('homepage_minimal_v6');
                setRadio(saved ? JSON.parse(saved) : DEFAULT_RADIO);
                const t = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(t);
            }, []);

            const save = (list) => {
                setRadio(list);
                localStorage.setItem('homepage_minimal_v6', JSON.stringify(list));
            };

            const togglePlay = (item) => {
                if (!item.streamUrl) return;
                if (playing === item.id) {
                    audio.current.pause();
                    audio.current.src = '';
                    setPlaying(null);
                } else {
                    audio.current.src = item.streamUrl;
                    audio.current.play().catch(e => console.error("Audio Error", e));
                    setPlaying(item.id);
                }
            };

            return (
                <div className="h-full flex flex-col items-center p-4 md:p-8 space-y-4 md:space-y-6 animate-fade no-scrollbar">
                    <header className="text-center md:pt-4">
                        <h1 className="text-6xl md:text-8xl font-normal tracking-tighter text-gray-950">
                            {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false })}
                        </h1>
                        <p className="text-[9px] md:text-[10px] uppercase tracking-[0.4em] text-gray-700 font-extrabold opacity-70">
                            {time.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'long' })}
                        </p>
                    </header>

                    <main className="w-full flex-grow flex flex-col justify-center space-y-4 md:space-y-10 max-w-2xl mx-auto">
                        <section>
                            <h2 className="text-[8px] uppercase tracking-[0.6em] text-gray-400 font-black mb-3 text-center">News</h2>
                            <div className="flex flex-wrap justify-center gap-4 md:gap-8">
                                {NEWS_LINKS.map(n => <GridItem key={n.id} item={n} />)}
                            </div>
                        </section>

                        <section>
                            <h2 className="text-[8px] uppercase tracking-[0.6em] text-gray-400 font-black mb-3 text-center">Tools</h2>
                            <div className="flex flex-wrap justify-center gap-4 md:gap-8">
                                {TOOL_LINKS.map(t => <GridItem key={t.id} item={t} />)}
                            </div>
                        </section>

                        <section className="pb-4">
                            <h2 className="text-[8px] uppercase tracking-[0.6em] text-gray-400 font-black mb-3 text-center">Radio</h2>
                            <div className="flex flex-wrap justify-center gap-4 md:gap-6 px-2">
                                {radio.map(r => (
                                    <GridItem 
                                        key={r.id} 
                                        item={r} 
                                        isRadio 
                                        isPlaying={playing === r.id}
                                        onTogglePlay={togglePlay}
                                        onRemove={id => save(radio.filter(x => x.id !== id))}
                                        onEdit={item => setModal({ open: true, item })}
                                    />
                                ))}
                                <button 
                                    onClick={() => setModal({ open: true, item: null })} 
                                    className="w-16 h-16 md:w-20 md:h-20 border-2 border-dashed border-gray-300 rounded-2xl flex items-center justify-center hover:border-black transition-all group"
                                >
                                    <span className="text-gray-300 group-hover:text-black text-2xl font-light">+</span>
                                </button>
                            </div>
                        </section>
                    </main>

                    <footer className="text-[7px] uppercase tracking-[1em] text-gray-400 pb-2 opacity-30 font-bold">Operational</footer>
                    
                    <StationModal 
                        isOpen={modal.open} 
                        item={modal.item} 
                        onClose={() => setModal({ open: false, item: null })} 
                        onConfirm={item => {
                            if (modal.item) save(radio.map(r => r.id === item.id ? item : r));
                            else save([...radio, item]);
                        }}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>